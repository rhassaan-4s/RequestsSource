<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN"
    "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
	<bean id="securityEnforcementFilter"
		class="org.acegisecurity.intercept.web.SecurityEnforcementFilter">
		<property name="filterSecurityInterceptor">
			<ref bean="securityInterceptor" />
		</property>
		<property name="authenticationEntryPoint">
			<ref bean="authenticationEntryPoint" />
		</property>
	</bean>

	<bean id="securityInterceptor"
		class="org.acegisecurity.intercept.web.FilterSecurityInterceptor">
		<property name="authenticationManager">
			<ref bean="authenticationManager" />
		</property>
		<property name="accessDecisionManager">
			<ref bean="accessDecisionManager" />
		</property>

		<property name="objectDefinitionSource">
			<value>
				\A/common/commonAdminCountryCities.html.*\Z=CAN_VIEW_page_common_commonAdminCountryCities
				\A/common/commonAdminEditCity.html.*\Z=CAN_VIEW_page_common_commonAdminEditCity
				\A/common/commonAdminCountries.html.*\Z=CAN_VIEW_page_common_commonAdminCountries
				\A/common/commonAdminEditCountry.html.*\Z=CAN_VIEW_page_common_commonAdminEditCountry
				\A/common/commonAdminDepartments.html.*\Z=CAN_VIEW_page_common_commonAdminDepartments
				\A/common/commonAdminEditDepartment.html.*\Z=CAN_VIEW_page_common_commonAdminEditDepartment
				\A/common/commonAdminEmployees.html.*\Z=CAN_VIEW_page_common_commonAdminEmployees
				\A/common/commonAdminEditEmployee.html.*\Z=CAN_VIEW_page_common_commonAdminEditEmployee
				\A/common/commonAdminChangePassword.html.*\Z=CAN_VIEW_page_common_commonAdminChangePassword
				\A/common/commonAdminRegions.html.*\Z=CAN_VIEW_page_common_regionsView
				\A/common/commonAdminEditRegion.html.*\Z=CAN_VIEW_page_common_regionForm


				\A/i18n/editMessage.html.*\Z=CAN_VIEW_page_i18n_editMessage
				\A/i18n/changeDefaultLocale.html.*\Z=CAN_VIEW_page_i18n_changeDefaultLocale
				\A/i18n/addNewLocale.html.*\Z=CAN_VIEW_page_i18n_addNewLocale


				\A/security/editSecurity.html.*\Z=CAN_VIEW_page_security_editSecurity
				<!--            	 \A/security/changeUserApplication.html.*\Z=CAN_VIEW_page_security_changeUserApplication-->
				\A/security/addNewRole.html.*\Z=CAN_VIEW_page_security_addNewRole
				\A/security/addUserToRole.html.*\Z=CAN_VIEW_page_security_addUserToRole
				\A/security/userDetails.html.*\Z=CAN_VIEW_page_security_userDetails
				\A/security/roleDetails.html.*\Z=CAN_VIEW_page_security_roleDetails
				\A/security/updateRole.html.*\Z=CAN_VIEW_page_security_updateRole
				
				
				\A/stores/storesAdminBranches.html.*\Z=CAN_VIEW_page_stores_storesAdminBranches
				\A/stores/codesDivisionForm.html.*\Z=CAN_VIEW_page_stores_codesDivisionForm
				\A/stores/storesAdminGroupf.html.*\Z=CAN_VIEW_page_stores_storesAdminGroupf
				\A/stores/basicGroupForm.html.*\Z=CAN_VIEW_page_stores_basicGroupForm
				\A/stores/addBranch.html.*\Z=CAN_VIEW_page_stores_addBranch
				\A/stores/storesAdminStores.html.*\Z=CAN_VIEW_page_stores_storesAdminStores
				\A/stores/storesAdminEditStores.html.*\Z=CAN_VIEW_page_stores_storesAdminEditStores
				\A/stores/storesAdminGroupTypes.html.*\Z=CAN_VIEW_page_stores_storesAdminGroupTypes
				\A/stores/storesAdminEditGroupType.html.*\Z=CAN_VIEW_page_stores_storesAdminEditGroupType
				\A/stores/storesAdminCustomers.html.*\Z=CAN_VIEW_page_stores_storesAdminCustomers
				\A/stores/storesAdminEditCustomer.html.*\Z=CAN_VIEW_page_stores_storesAdminEditCustomer
				\A/stores/storesAdminAgents.html.*\Z=CAN_VIEW_page_stores_storesAdminAgents
				\A/stores/storesAdminEditAgent.html.*\Z=CAN_VIEW_page_stores_storesAdminEditAgent
				\A/stores/storesAdminVendors.html.*\Z=CAN_VIEW_page_stores_storesAdminVendors
				\A/stores/storesAdminEditVendors.html.*\Z=CAN_VIEW_page_stores_storesAdminEditVendors
				\A/stores/storesAdminSalesRep.html.*\Z=CAN_VIEW_page_stores_storesAdminSalesRep
				\A/stores/storesAdminEditSalesRep.html.*\Z=CAN_VIEW_page_stores_storesAdminEditSalesRep
				\A/stores/storesAdminPersons.html.*\Z=CAN_VIEW_page_stores_storesAdminPersons
				\A/stores/storesAdminEditPersons.html.*\Z=CAN_VIEW_page_stores_storesAdminEditPersons
				\A/stores/storesAdminItemData.html.*\Z=CAN_VIEW_page_stores_storesAdminItemData
				\A/stores/storesAdminEditItemData.html.*\Z=CAN_VIEW_page_stores_storesAdminEditItemData
				\A/stores/storesAdminBasicUnit.html.*\Z=CAN_VIEW_page_stores_storesAdminBasicUnit
				\A/stores/storesAdminEditBasicUnit.html.*\Z=CAN_VIEW_page_stores_storesAdminEditBasicUnit
				\A/stores/storesAdminEditFirstBalanceStore.html.*\Z=CAN_VIEW_page_stores_storesAdminEditFirstBalanceStore
				\A/stores/storesAdminContractors.html.*\Z=CAN_VIEW_page_stores_storesAdminContractors
				\A/stores/storesAdminEditContractor.html.*\Z=CAN_VIEW_page_stores_storesAdminEditContractor
				\A/stores/itemsMainGroupDescription.html.*\Z=CAN_VIEW_page_stores_itemsMainGroupDescription
				\A/stores/storesAdminStoreTrnsDefs.html.*\Z=CAN_VIEW_page_stores_storesAdminStoreTrnsDefs
				\A/stores/storesAdminEditStoreTrnsDef.html.*\Z=CAN_VIEW_page_stores_storesAdminEditStoreTrnsDef
				\A/stores/storesAdminEditStoreTrnsDefSpec.html.*\Z=CAN_VIEW_page_stores_storesAdminEditStoreTrnsDefSpec
				\A/stores/storesAdminEditStoreTrnsDefTax.html.*\Z=CAN_VIEW_page_stores_storesAdminEditStoreTrnsDefTax
				\A/stores/storesAdminListStoreTransaction.html.*\Z=CAN_VIEW_page_stores_storesAdminListStoreTransaction
				\A/stores/storesAdminEditStoreTransaction.html.*\Z=CAN_VIEW_page_stores_storesAdminEditStoreTransaction
				\A/stores/storesAdminPaletteNumber.html.*\Z=CAN_VIEW_page_stores_storesAdminPaletteNumber
				\A/stores/storesAdminEditPaletteNumber.html.*\Z=CAN_VIEW_page_stores_storesAdminEditPaletteNumber
				\A/stores/storesAdminRoomMeasures.html.*\Z=CAN_VIEW_page_stores_storesAdminRoomMeasures
				\A/stores/storesAdminEditRoomMeasures.html.*\Z=CAN_VIEW_page_stores_storesAdminEditRoomMeasures
				\A/stores/storesAdminCostCenter.html.*\Z=CAN_VIEW_page_stores_storesAdminCostCenter
				\A/stores/storesAdminEditCostCenter.html.*\Z=CAN_VIEW_page_stores_storesAdminEditCostCenter
				\A/stores/storesCreateInvoices.html.*\Z=CAN_VIEW_page_stores_storesCreateInvoices
				\A/stores/storesAdminAddStoreTransaction.html.*\Z=CAN_VIEW_page_stores_storesAdminAddStoreTransaction
				\A/stores/storesCloseContract.html.*\Z=CAN_VIEW_page_stores_storesCloseContract
				\A/stores/storesExternalTransaction.html.*\Z=CAN_VIEW_page_stores_storesExternalTransaction
				\A/stores/storesAdminMultiPalette.html.*\Z=CAN_VIEW_page_stores_storesAdminMultiPalette
				\A/stores/storesRoomMeasuresReport.html.*\Z=CAN_VIEW_page_stores_storesRoomMeasuresReport
				\A/stores/storesChoseModule.html.*\Z=CAN_VIEW_page_stores_storesChoseModule
				\A/stores/storesAdminDependenceSpec.html.*\Z=CAN_VIEW_page_stores_storesAdminDependenceSpec
				\A/stores/storesExternalDependenceOn.html.*\Z=CAN_VIEW_page_stores_storesExternalDependenceOn
				\A/stores/storesExternalDependenceTo.html.*\Z=CAN_VIEW_page_stores_storesExternalDependenceTo
				\A/stores/storesAdminDBConnection.html.*\Z=CAN_VIEW_page_stores_storesAdminDBConnection
				\A/stores/storesAdminEditDBConnection.html.*\Z=CAN_VIEW_page_stores_storesAdminEditDBConnection
				
				<!-- GL -->
				\A/gl/account.html.*\Z=CAN_VIEW_page_account
				\A/gl/accountForm.html.*\Z=CAN_VIEW_page_accountForm
				\A/gl/accountTypeForm.html.*\Z=CAN_VIEW_page_accountTypeForm
				\A/gl/currency.html.*\Z=CAN_VIEW_page_currency
				\A/gl/currencyForm.html.*\Z=CAN_VIEW_page_currencyForm
				\A/gl/financialPeriod.html.*\Z=CAN_VIEW_page_financialPeriod
				\A/gl/financialPeriodForm.html.*\Z=CAN_VIEW_page_financialPeriodForm
				\A/gl/docType.html.*\Z=CAN_VIEW_page_docType
				\A/gl/docTypeForm.html.*\Z=CAN_VIEW_page_docTypeForm
				\A/gl/masterBudget.html.*\Z=CAN_VIEW_page_masterBudget
				\A/gl/masterBudgetForm.html.*\Z=CAN_VIEW_page_masterBudgetForm
				\A/gl/masterTransactionForm.html.*\Z=CAN_VIEW_page_masterTransaction
				\A/gl/repeatableMasterTransactionForm.html.*\Z=CAN_VIEW_page_repeatableMasterTransactionForm
				\A/gl/searchRepeatableForm.html.*\Z=CAN_VIEW_page_searchRepeatableForm
				\A/gl/activateRepeatableTransactionForm.html.*\Z=CAN_VIEW_page_activateRepeatableTransact
				\A/gl/searchUnpostedTransaction.html.*\Z=CAN_VIEW_page_searchUnpostedTransaction
				\A/gl/searchTransaction.html.*\Z=CAN_VIEW_page_searchTransaction
				\A/gl/accountStatusReport.html.*\Z=CAN_VIEW_page_accountStatusReport
				\A/gl/accountTransactionsReport.html.*\Z=CAN_VIEW_page_accountTransactionsReport
				\A/gl/transactionDetails.html.*\Z=CAN_VIEW_page_transactionDetails
				
				\A/gl/suspendTransaction.html.*\Z=CAN_VIEW_page_suspendTransaction
				\A/gl/financialYear.html.*\Z=CAN_VIEW_page_financialYear
				\A/gl/financialYearForm.html.*\Z=CAN_VIEW_page_financialYearForm
				\A/gl/reports.html.*\Z=CAN_VIEW_page_reports
				\A/gl/addDetailedBudgetManually.html.*\Z=CAN_VIEW_page_addDetailedBudgetManually
				\A/gl/addEstimatedBalance.html.*\Z=CAN_VIEW_page_addEstimatedBalance
				<!-- ///////////////////////////////////////////////// -->
				<!-- RequestsApproval -->
				\A/requestsApproval/loginUsersRequestsView.html.*\Z=CAN_VIEW_page_RequestsAproval_generalEmployee
				\A/requestsApproval/empRequestsReportsForm.html.*\Z=CAN_VIEW_page_requestsApproval
				\A/requestsApproval/requestsApprovalForm.html.*\Z=CAN_VIEW_page_requestsApproval
				\A/requestsApproval/loginUsersRequestsForm.html.*\Z=CAN_VIEW_page_RequestsAproval_generalEmployee
				\A/requestsApproval/reports.html.*\Z=CAN_VIEW_page_requestsApproval
				\A/requestsApproval/accessLevelsForm.html.*\Z=CAN_VIEW_page_approvement
				\A/requestsApproval/empReqTypeGroupForm.html.*\Z=CAN_VIEW_page_approvement
				\A/requestsApproval/empGroupsView.html.*\Z=CAN_VIEW_page_approvement
				\A/requestsApproval/annualVacLimitSetting.html.*\Z=CAN_VIEW_page_approvement
				
				
				
				<!-- Fixed Assets -->
				
				<!--\A/fixedAssets/depreciation.html.*\Z=CAN_VIEW_ALL_Assets-->
				
				<!-- /////////////////////////////////// -->
			</value>
		</property>
	</bean>


	<bean id="authenticationManager"
		class="org.acegisecurity.providers.ProviderManager">
		<property name="providers">
			<list>
				<ref bean="authenticationProvider" />
			</list>
		</property>
		
<!--  to prevent concurrent logins -->
		<property name="sessionController">
			<ref bean="concurrentSessionController"/>
		</property>
	</bean>


	<bean id="authenticationProcessingFilter"
		class="org.acegisecurity.ui.webapp.AuthenticationProcessingFilter">
		<property name="filterProcessesUrl">
			<value>/security/j_acegi_security_check</value>
		</property>
		<property name="authenticationFailureUrl">
			<value>/security/login.html?failed=true</value>
		</property>
		<property name="defaultTargetUrl">
			<value>/security/defaultPage.html</value>
		</property>
		<property name="authenticationManager">
			<ref bean="authenticationManager" />
		</property>
		<property name="alwaysUseDefaultTargetUrl">
			<value>true</value>
		</property>
	</bean>



	<bean id="authenticationEntryPoint"
		class="org.acegisecurity.ui.webapp.AuthenticationProcessingFilterEntryPoint">
		<property name="loginFormUrl">
			<value>/security/login.html</value>
		</property>
		<property name="forceHttps">
			<value>false</value>
		</property>
	</bean>
	
<!--	<bean id="userCache" -->
<!--		class="org.acegisecurity.providers.dao.cache.EhCacheBasedUserCache">-->
<!--	  	<property name="minutesToIdle">-->
<!--	  		<value>30</value>-->
<!--		</property>-->
<!--	</bean>-->
 
	<!-- Start  Caching Beans  --> 	
	
	 	<bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean"/>
	    
	    <bean id="userCacheBackend" class="org.springframework.cache.ehcache.EhCacheFactoryBean">
	      <property name="cacheManager">
	         <ref local="cacheManager"/>
	      </property>
	      <property name="cacheName">
	         <value>userCache</value>
	      </property>
	      <property name="eternal">
	         <value>true</value>
	      </property>
	   </bean>
	   
	   <bean id="userCache" class="org.acegisecurity.providers.dao.cache.EhCacheBasedUserCache">
	      <property name="cache"><ref local="userCacheBackend"/></property>
	   </bean>
	
	<!-- End  Caching Beans  --> 	


	<bean id="authenticationProvider"
		class="org.acegisecurity.providers.dao.DaoAuthenticationProvider">
		<!--  		<property name="passwordEncoder">
			<bean
			class="org.acegisecurity.providers.encoding.Md5PasswordEncoder" />
			</property> -->
		<property name="userDetailsService">
			<ref bean="authenticationDao" />
		</property>
		<property name="userCache">
  			<ref bean="userCache"/>
		</property>
	</bean>

	<bean id="authenticationDao"
		class="org.acegisecurity.userdetails.jdbc.JdbcDaoImpl">
		<property name="dataSource">
			<ref bean="dataSource" />
		</property>
		<property name="usersByUsernameQuery">
			<value>
				SELECT userName, password,1 as enabled FROM
				security_users WHERE userName=?
			</value>
		</property>
		<property name="authoritiesByUsernameQuery">
			<value>
				select distinct userName,permessionname from
				security_users,security_user_roles,security_role_permissions,security_permissions,security_roles
				where security_users.id=security_user_roles.users and
				security_user_roles.role=security_roles.id and
				security_role_permissions.role=security_roles.id and
				security_role_permissions.permission=security_permissions.id
				and selected=1 and security_users.isActive=1 and (end_serv is null or (END_SERV >=  SYSDATE)) and userName=?
			</value>
		</property>
	</bean>

	<bean id="roleVoter" class="org.acegisecurity.vote.RoleVoter">
		<property name="rolePrefix">
			<value>CAN_</value>
		</property>

	</bean>

	<bean id="myVoter" class="com._4s_.security.service.MyVoter">
		<property name="rolePrefix">
			<value>My_</value>
		</property>
<!--		<property name="baseManager"><ref bean="baseManager"/></property>-->
	</bean>

	<bean id="accessDecisionManager"
		class="org.acegisecurity.vote.AffirmativeBased">
		<property name="decisionVoters">
			<list>
			
				<ref bean="roleVoter" />
			</list>
		</property>
		<property name="allowIfAllAbstainDecisions">
			<value>true</value>
		</property>
	</bean>
	<bean id="myAccessDecisionManager"
		class="org.acegisecurity.vote.AffirmativeBased">
		<property name="decisionVoters">
			<list>
				<ref bean="myVoter" />
			</list>
		</property>
		<property name="allowIfAllAbstainDecisions">
			<value>true</value>
		</property>
	</bean>

	<bean id="integrationFilter"
		class="org.acegisecurity.context.HttpSessionContextIntegrationFilter" />
		
		<!--  to prevent concurrent logins -->
	<bean id="concurrentSessionController" class="org.acegisecurity.concurrent.ConcurrentSessionControllerImpl">
  		<property name="maximumSessions"><value>1</value></property>
  		<property name="exceptionIfMaximumExceeded"><value>1</value></property>
 		 <property name="sessionRegistry"><ref local="sessionRegistry"/></property>
	</bean>

	<bean id="sessionRegistry" class="org.acegisecurity.concurrent.SessionRegistryImpl"/>


</beans>