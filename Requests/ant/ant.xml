<?xml version="1.0"?>
<project name="Requests" basedir="." default="reload.application">
	<property environment="env"/>
	<property name="tomcat.home" value="${env.CATALINA_HOME}"/>
	<property name="user.home" value="${evn.HOME}"/>
	<property name="project.name" value="Requests"/>
	<property name="project.dir" value="${user.home}/dev/eclipse/production/${project.name}"/>
	<property name="jar.dir" value="${project.dir}/jar"/>
	
	<taskdef file="${tomcat.home}/webapps/${project.name}/properties/tomcatTasks.properties">
	    <classpath>
	        <pathelement path="${tomcat.home}/server/lib/catalina-ant.jar"/>
	    </classpath>
	</taskdef>

	<target name="reload.application">
		<copy todir="${tomcat.home}/webapps/${project.name}/WEB-INF/classes">
					<fileset dir="${tomcat.home}/webapps/${project.name}/properties" includes="*.properties"/>
		</copy>
		   <reload url="http://localhost:8080/manager"
		        username="admin"
		        password="admin"
		        path="/${project.name}"/>
	</target>
	
	<path id="xdoclet.classpath">
		    <fileset dir="${tomcat.home}/webapps/${project.name}/WEB-INF/lib" includes="xdoclet*.jar"/>
			<fileset dir="${tomcat.home}/webapps/${project.name}/WEB-INF/lib" includes="commons*.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/WEB-INF/lib" includes="xjavadoc*.jar"/>
	</path>
	
	
	
	<!-- Xdoclet Hibernate -->
		<target name="generate.hbm"
		    description="Generate Hibernate mapping files">
			<echo level="info">Generating Hibernate mapping files for model...</echo>
			<delete>
				<fileset dir="${tomcat.home}/webapps/${project.name}/src/application" includes="com/*/*/**/*.hbm.xml"/>
			</delete>
			
		    <taskdef name="hibernatedoclet"
		        classname="xdoclet.modules.hibernate.HibernateDocletTask"
		    	classpathref="xdoclet.classpath"
		    />
			
		    <!-- generate hibernate files -->
		    <hibernatedoclet
		        destdir="${tomcat.home}/webapps/${project.name}/src/application"
		        excludedtags="@version,@author,@Entity"
		        addedtags="@xdoclet-generated at ${TODAY}"
		       >
		    	
		    	
				<fileset dir="${tomcat.home}/webapps/${project.name}/src/application">
		        	<include name="com/_4s_/banks/model/FinancialMasterTransaction.java"/> 
					<include name="com/_4s_/banks/model/Transaction.java"/> 
		        </fileset>
					
		        <hibernate validatexml="true" version="3.0"/>
		        
		    </hibernatedoclet>
			
		</target>
	
	
	<!-- take backup of the whole project -->
	<target name="backup.project">
		 <tstamp>
		    <format property="dateTime" pattern="yyyy-MM-dd hh:mm" locale="en"/>
		 </tstamp>
		<mkdir dir="${user.home}/eclipseBackup/${project.name}_backup_${dateTime}"/>
		<copy todir="${user.home}/eclipseBackup/${project.name}_backup_${dateTime}">
					<fileset dir="${tomcat.home}/webapps/${project.name}"/>
		</copy>
	</target>
	
	<!--
	<path id="hibernateTool.classpath">
		<fileset dir="${tomcat.home}/webapps/${project.name}/ant" includes="hibernate3.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/ant" includes="hibernate-tools*.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/WEB-INF/lib" includes="mysql-connector-java*.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/ant" includes="velocity*.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/ant" includes="jtidy*.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/ant" includes="commons*.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/ant" includes="hibernate-annotations.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/ant" includes="dom4j*.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/ant" includes="jta.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/ant" includes="ejb3-persistence.jar"/>
		<fileset dir="${tomcat.home}/webapps/${project.name}/ant" includes="log4j*.jar"/>
		<pathelement location="${tomcat.home}/webapps/${project.name}/WEB-INF/classes"/>
	</path>
			
	<target name="hibernatetool">
		 <taskdef name="hibernatetool"
		        classname="org.hibernate.tool.ant.HibernateToolTask"
		        classpathref="hibernateTool.classpath"/>
		    
		<hibernatetool destdir="${tomcat.home}/webapps/${project.name}/ant">
			
			<annotationconfiguration configurationfile="hibernate.cfg.xml"/>
			<hbm2ddl
				export="false"
				drop="false"
				update="true"
				outputfilename="schema.sql" 
				delimiter = ";"/>
		</hibernatetool>
	</target>-->
	
	<target name="create dataMigration jar" 
						description="Creating a jar">
						
					    <echo message="Creating a jar"/>
						
						<delete>
							<fileset dir="${jar.dir}" includes="*.jar"/>
						</delete>
						
						<jar destfile="${jar.dir}/DataMigration.jar">
							<fileset dir="${project.dir}/WEB-INF/classes">
								<exclude name="lib/**"/>
							</fileset>
							<manifest>
						        <attribute name="Built-By" value="Requests"/>
								<attribute name="Main-Class" value="dataMigration.DataMigration"/>
								<attribute name="Class-Path" value="
									lib/commons-logging.jar
									lib/mysql-connector-java-5.0.5-bin.jar
									lib/commons-lang.jar
									"/>
					        </manifest>
						</jar>
						

						<mkdir dir="${jar.dir}/lib"/>
						<copy todir="${jar.dir}/lib">
							<fileset dir="${project.dir}/WEB-INF/lib/"/>
						</copy>
						
						<delete dir="${jar.dir}/META-INF"/>
					
					</target>

		<target name="create olApplicantsMigration jar" 
							description="Creating a jar">
							
						    <echo message="Creating a jar"/>
							
							<delete>
								<fileset dir="${jar.dir}" includes="*.jar"/>
							</delete>
							
							<jar destfile="${jar.dir}/OldApplicantsMigration.jar">
								<fileset dir="${project.dir}/WEB-INF/classes">
									<exclude name="lib/**"/>
								</fileset>
								<manifest>
							        <attribute name="Built-By" value="Requests"/>
									<attribute name="Main-Class" value="dataMigration.RegisteredApplicantsMigration"/>
									<attribute name="Class-Path" value="
										lib/commons-logging.jar
										lib/mysql-connector-java-5.0.5-bin.jar
										lib/commons-lang.jar
										"/>
						        </manifest>
							</jar>
							

							<mkdir dir="${jar.dir}/lib"/>
							<copy todir="${jar.dir}/lib">
								<fileset dir="${project.dir}/WEB-INF/lib/"/>
							</copy>
							
							<delete dir="${jar.dir}/META-INF"/>
						
						</target>


		<target name="create updateApplicantNumber jar" 
								description="Creating a jar">
								
							    <echo message="Creating a jar"/>
								
								<delete>
									<fileset dir="${jar.dir}" includes="*.jar"/>
								</delete>
								
								<jar destfile="${jar.dir}/UpdateApplicantNumber.jar">
									<fileset dir="${project.dir}/WEB-INF/classes">
										<exclude name="lib/**"/>
									</fileset>
									<manifest>
								        <attribute name="Built-By" value="Requests"/>
										<attribute name="Main-Class" value="dataMigration.UpdateApplicantNumber"/>
										<attribute name="Class-Path" value="
											lib/commons-logging.jar
											lib/mysql-connector-java-5.0.5-bin.jar
											lib/commons-lang.jar
											"/>
							        </manifest>
								</jar>
								

								<mkdir dir="${jar.dir}/lib"/>
								<copy todir="${jar.dir}/lib">
									<fileset dir="${project.dir}/WEB-INF/lib/"/>
								</copy>
								
								<delete dir="${jar.dir}/META-INF"/>
							
							</target>
	
	
</project>
