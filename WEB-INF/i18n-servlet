<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="
	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
	http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd">


  <context:component-scan
	base-package="com._4s_.i18n.*" />

	<tx:annotation-driven proxy-target-class="true"
		transaction-manager="transactionManager" />

	<mvc:annotation-driven />
	
	<bean id="editMessageFormController"
		parent="txProxyTemplate">
		<property name="target">
			<bean class="com._4s_.i18n.web.action.EditMessage">
				<property name="commandName">
					<value>msg</value>
				</property>
				<property name="commandClass">
					<value>com._4s_.i18n.model.MyMessage</value>
				</property>
				<property name="formView">
					<value>editMessage</value>
				</property>
				<property name="messageDAO">
					<ref bean="messageDAO"/>
				</property>
				<property name="mgr">
					<ref bean="messageManager"/>
				</property>
				<property name="localeSource">
					<ref bean="defaultLocale"/>
				</property>
				<property name="cacheMap">
					<ref bean="messageSource"/>
				</property>
				<property name="rollbackMode">
					<value>ROLLBACK_ON_ERROR</value>
				</property>
				<property name="validator">
					<ref bean="validateMessage"/>
				</property>
			</bean>
		</property>
	</bean>
	
	<bean id="changeDefaultLocaleFormController"
		parent="txProxyTemplate">
		<property name="target">
			<bean class="com._4s_.i18n.web.action.ChangeDefaultLocale">
				<property name="commandName">
					<value>myLocale</value>
				</property>
				<property name="commandClass">
					<value>com._4s_.i18n.model.MyLocale</value>
				</property>
				<property name="formView">
					<value>changeDefaultLocale</value>
				</property>
				<property name="mgr">
					<ref bean="messageManager"/>
				</property>
				<property name="defaultOne">
					<ref bean="defaultLocale" />
				</property>
				<property name="localeSource">
					<ref bean="defaultLocale"/>
				</property>
				<property name="cacheMap">
					<ref bean="messageSource"/>
				</property>
				<property name="successView">
					<value>changeDefaultLocale.html</value>
				</property>
				<property name="rollbackMode">
					<value>ROLLBACK_ON_ERROR</value>
				</property>
				<property name="binders">
					<list>
						<ref bean="localeBinder"/>
					</list>
				</property>
			</bean>
		</property>
	</bean>
	
		<bean id="changeUserLanguageFormController"
		parent="txProxyTemplate">
		<property name="target">
			<bean class="com._4s_.i18n.web.action.ChangeUserPreference">
				<property name="commandName">
					<value>user</value>
				</property>
				<property name="commandClass">
					<value>com._4s_.security.model.User</value>
				</property>
				<property name="formView">
					<value>changeUserLanguage</value>
				</property>
				<property name="baseManager">
					<ref bean="baseManager"/>
				</property>
				<property name="userMap">
					<ref bean="users"/>
				</property>
				<property name="rollbackMode">
					<value>ROLLBACK_ON_ERROR</value>
				</property>
				<property name="binders">
					<list>
						<ref bean="localeBinder"/>
					</list>
				</property>
			</bean>
		</property>
	</bean>
	
	<bean id="allLocalesController" parent="txProxyTemplate">
		<property name="target">
			<bean
				class="com._4s_.i18n.web.action.LocalesController">
				<property name="baseManager">
					<ref bean="baseManager"/>
				</property>
			</bean>
		</property>
	</bean>
	
	
	<bean id="addNewLocaleFormController"
		parent="txProxyTemplate">
		<property name="target">
			<bean class="com._4s_.i18n.web.action.AddNewLocale">
				<property name="commandName">
					<value>myLocale</value>
				</property>
				<property name="commandClass">
					<value>com._4s_.i18n.model.MyLocale</value>
				</property>
				<property name="formView">
					<value>addNewLocale</value>
				</property>
				<property name="mgr">
					<ref bean="messageManager"/>
				</property>
				<property name="baseManager">
					<ref bean="baseManager"/>
				</property>
				<property name="rollbackMode">
					<value>ROLLBACK_ON_ERROR</value>
				</property>
				<property name="binders">
					<list>
						<ref bean="localeBinder"/>
					</list>
				</property>
				<property name="validator">
					<ref bean="validateLocale"/>
				</property>
			</bean>
		</property>
	</bean>
	
	
	<bean id="urlMapping"
		class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="interceptors">
			<list>
				<ref bean="openSessionInViewInterceptor" />
			</list>
		</property>
		<property name="mappings">
			<props>
				<prop key="/editMessage.html">editMessageFormController</prop>
				<prop key="/changeDefaultLocale.html">changeDefaultLocaleFormController</prop>
				<prop key="/changeUserLanguage.html">changeUserLanguageFormController</prop>
				<prop key="/allLocales.html">allLocalesController</prop>
				<prop key="/addNewLocale.html">addNewLocaleFormController</prop>
		</props>
		</property>
	</bean>
	
	<bean id="viewResolver"
		class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="requestContextAttribute">
			<value>rc</value>
		</property>
		<property name="viewClass">
			<value>org.springframework.web.servlet.view.JstlView</value>
		</property>
		<property name="prefix">
			<value>/web/i18n/</value>
		</property>
		<property name="suffix">
			<value>.jsp</value>
		</property>
	</bean>
	
	
</beans>